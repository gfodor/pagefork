// Generated by CoffeeScript 1.5.0
(function() {

  $(function() {
    var docIds, phorkId;
    docIds = [];
    phorkId = $('body').data('phorkId');
    return $.get("/phorks/" + phorkId + ".json", {
      dataType: "json"
    }, function(res) {
      var doc, docInfo, sjs, socket, _i, _len, _ref, _results;
      socket = new BCSocket(null, {
        reconnect: true
      });
      sjs = new window.sharejs.Connection(socket);
      _ref = res.docs;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        docInfo = _ref[_i];
        if (docInfo.primary) {
          doc = sjs.get('docs', docInfo.doc_id);
          doc.subscribe();
          _results.push(doc.whenReady(function() {
            var codeMirror, component;
            codeMirror = CodeMirror.fromTextArea($("#htmlEditor")[0], {
              mode: "text/" + docInfo.type
            });
            doc.attachCodeMirror(codeMirror);
            component = new HtmlRenderer({
              content: doc.snapshot
            });
            return setTimeout(function() {
              var target;
              target = $("#html")[0];
              return React.renderComponent(component, $("#html")[0]);
            }, 0);
          }));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    });
  });

}).call(this);
